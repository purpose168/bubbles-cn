# Bubbles-CN 技术栈说明

## 概述

Bubbles-CN 是一个基于 Go 语言开发的终端用户界面（TUI）组件库。本文档详细说明了项目使用的技术栈、依赖组件及其版本信息。

## 核心技术栈

### 编程语言

| 技术 | 版本 | 用途 |
|------|------|------|
| **Go** | 1.24.2 | 主要开发语言 |

Go 语言的选择基于以下优势：
- **高性能**: 编译型语言，执行效率高
- **并发支持**: 原生支持 goroutine，适合处理并发事件
- **跨平台**: 良好的跨平台支持
- **静态类型**: 编译时类型检查，减少运行时错误
- **简洁语法**: 易于学习和维护

### 框架层

#### 1. Bubble Tea

| 属性 | 值 |
|------|-----|
| **包路径** | github.com/purpose168/bubbletea-cn |
| **版本** | v0.0.0 (本地开发版本) |
| **用途** | Elm 架构框架，提供 MVU 架构基础 |

**核心功能**:
- Model-View-Update (MVU) 架构实现
- 消息传递机制
- 事件循环管理
- 组件生命周期管理

**依赖关系**:
```go
import tea "github.com/purpose168/bubbletea-cn"
```

#### 2. Lipgloss

| 属性 | 值 |
|------|-----|
| **包路径** | github.com/purpose168/lipgloss-cn |
| **版本** | v0.0.0 (本地开发版本) |
| **用途** | 样式和布局引擎 |

**核心功能**:
- 终端样式（颜色、粗体、斜体等）
- 布局管理（水平、垂直、网格）
- 边框和间距
- 响应式设计

**依赖关系**:
```go
import lipgloss "github.com/purpose168/lipgloss-cn"
```

### 基础设施层

#### 1. ANSI

| 属性 | 值 |
|------|-----|
| **包路径** | github.com/purpose168/charm-experimental-packages-cn/ansi |
| **版本** | v0.10.2 |
| **用途** | ANSI 转义序列处理 |

**核心功能**:
- 终端颜色支持
- 光标控制
- 屏幕清空
- 终端能力检测

**依赖关系**:
```go
import "github.com/purpose168/charm-experimental-packages-cn/ansi"
```

#### 2. Term

| 属性 | 值 |
|------|-----|
| **包路径** | github.com/purpose168/charm-experimental-packages-cn/term |
| **版本** | v0.2.1 |
| **用途** | 终端抽象层 |

**核心功能**:
- 终端尺寸检测
- 备用屏幕缓冲区
- 终端模式切换
- 鼠标事件处理

**依赖关系**:
```go
import "github.com/purpose168/charm-experimental-packages-cn/term"
```

#### 3. Cellbuf

| 属性 | 值 |
|------|-----|
| **包路径** | github.com/purpose168/charm-experimental-packages-cn/cellbuf |
| **版本** | v0.0.13 |
| **用途** | 单元格缓冲区管理 |

**核心功能**:
- 单元格级别的渲染
- 高效的缓冲区管理
- 增量更新支持

**依赖关系**:
```go
import "github.com/purpose168/charm-experimental-packages-cn/cellbuf"
```

### 工具库

#### 1. 字符处理

| 包名 | 版本 | 用途 |
|------|------|------|
| **github.com/mattn/go-runewidth** | v0.0.19 | 字符宽度计算（支持全角字符） |
| **github.com/rivo/uniseg** | v0.4.7 | Unicode 分段处理 |
| **github.com/clipperhouse/displaywidth** | v0.10.0 | 显示宽度计算 |
| **github.com/clipperhouse/uax29/v2** | v2.6.0 | Unicode 文本分割 |

**用途说明**:
- 正确处理多字节字符（中文、日文、韩文等）
- 计算字符在终端中的实际显示宽度
- 文本换行和截断处理

#### 2. 颜色处理

| 包名 | 版本 | 用途 |
|------|------|------|
| **github.com/lucasb-eyer/go-colorful** | v1.3.0 | 颜色处理和渐变 |
| **github.com/charmbracelet/colorprofile** | v0.4.1 | 颜色配置文件 |

**用途说明**:
- RGB 颜色转换
- 颜色渐变生成
- 终端颜色能力检测

#### 3. 终端交互

| 包名 | 版本 | 用途 |
|------|------|------|
| **github.com/erikgeiser/coninput** | v0.0.0-20211004153227-1c3628e74d0f | Windows 控制台输入 |
| **github.com/muesli/cancelreader** | v0.2.2 | 可取消的读取器 |
| **github.com/muesli/termenv** | v0.16.0 | 终端环境检测 |
| **github.com/mattn/go-isatty** | v0.0.20 | 终端检测 |
| **github.com/mattn/go-localereader** | v0.0.1 | 区域设置读取 |

**用途说明**:
- 跨平台终端输入处理
- 终端能力检测
- 区域设置支持

#### 4. 剪贴板操作

| 包名 | 版本 | 用途 |
|------|------|------|
| **github.com/atotto/clipboard** | v0.1.4 | 跨平台剪贴板操作 |

**用途说明**:
- 支持剪贴板复制和粘贴
- 跨平台兼容（Windows、macOS、Linux）

#### 5. 文本处理

| 包名 | 版本 | 用途 |
|------|------|------|
| **github.com/sahilm/fuzzy** | v0.1.1 | 模糊搜索 |
| **github.com/aymanbagabas/go-udiff** | v0.3.1 | 统一差异 |
| **github.com/MakeNowJust/heredoc** | v1.0.0 | Heredoc 文档字符串 |

**用途说明**:
- 列表过滤和搜索
- 文本差异比较
- 多行字符串处理

#### 6. 动画支持

| 包名 | 版本 | 用途 |
|------|------|------|
| **github.com/charmbracelet/harmonica** | v0.2.0 | 动画效果 |

**用途说明**:
- 平滑的动画过渡
- 弹簧物理效果
- 进度条动画

#### 7. 其他工具

| 包名 | 版本 | 用途 |
|------|------|------|
| **github.com/dustin/go-humanize** | v1.0.1 | 人类可读格式化 |
| **github.com/xo/terminfo** | v0.0.0-20220910002029-abceb7e1c41e | Terminfo 数据库 |

**用途说明**:
- 文件大小、时间等格式化
- 终端能力数据库

### 系统库

| 包名 | 版本 | 用途 |
|------|------|------|
| **golang.org/x/sys** | v0.41.0 | 系统调用封装 |
| **golang.org/x/text** | v0.24.0 | 文本处理扩展 |

**用途说明**:
- 跨平台系统调用
- Unicode 文本处理
- 编码转换

### OSC52 支持

| 包名 | 版本 | 用途 |
|------|------|------|
| **github.com/aymanbagabas/go-osc52/v2** | v2.0.1 | OSC52 剪贴板协议 |

**用途说明**:
- 通过终端转义序列进行剪贴板操作
- SSH 远程会话中的剪贴板支持

## 依赖关系图

```
Bubbles-CN
│
├── Bubble Tea (MVU 框架)
│   ├── ANSI (终端控制)
│   ├── Term (终端抽象)
│   └── Cellbuf (单元格缓冲)
│
├── Lipgloss (样式引擎)
│   ├── go-colorful (颜色处理)
│   ├── colorprofile (颜色配置)
│   └── termenv (终端环境)
│
├── 字符处理
│   ├── go-runewidth (字符宽度)
│   ├── uniseg (Unicode 分段)
│   ├── displaywidth (显示宽度)
│   └── uax29 (文本分割)
│
├── 终端交互
│   ├── coninput (Windows 输入)
│   ├── cancelreader (可取消读取)
│   ├── termenv (终端环境)
│   ├── go-isatty (终端检测)
│   └── localereader (区域设置)
│
├── 文本处理
│   ├── fuzzy (模糊搜索)
│   ├── go-udiff (差异比较)
│   └── heredoc (多行字符串)
│
├── 动画支持
│   └── harmonica (动画效果)
│
├── 剪贴板
│   ├── clipboard (剪贴板操作)
│   └── go-osc52 (OSC52 协议)
│
└── 系统库
    ├── golang.org/x/sys (系统调用)
    └── golang.org/x/text (文本处理)
```

## 版本管理

### Go 模块

Bubbles-CN 使用 Go Modules 进行依赖管理：

```go
module github.com/purpose168/bubbles-cn

go 1.24.2
```

### 本地依赖替换

项目使用本地依赖替换，便于开发和调试：

```go
replace (
    github.com/purpose168/bubbletea-cn => ../bubbletea-cn
    github.com/purpose168/charm-experimental-packages-cn/ansi => ../charm-experimental-packages-cn/ansi
    github.com/purpose168/charm-experimental-packages-cn/cellbuf => ../charm-experimental-packages-cn/cellbuf
    github.com/purpose168/charm-experimental-packages-cn/exp/golden => ../charm-experimental-packages-cn/exp/golden
    github.com/purpose168/charm-experimental-packages-cn/term => ../charm-experimental-packages-cn/term
    github.com/purpose168/lipgloss-cn => ../lipgloss-cn
)
```

### 依赖管理命令

```bash
# 整理依赖
go mod tidy

# 验证依赖
go mod verify

# 下载依赖
go mod download

# 查看依赖树
go list -m -u -json all
```

## 开发工具

### 代码检查

| 工具 | 用途 |
|------|------|
| **golangci-lint** | Go 代码静态分析 |
| **go vet** | Go 官方代码检查 |
| **gofmt** | Go 代码格式化 |

### 测试工具

| 工具 | 用途 |
|------|------|
| **go test** | Go 内置测试框架 |
| **go test -race** | 竞态条件检测 |
| **go test -cover** | 代码覆盖率 |

### 构建工具

| 工具 | 用途 |
|------|------|
| **go build** | 编译 Go 代码 |
| **go install** | 安装 Go 程序 |
| **Make** | 构建自动化 |

## 平台支持

### 支持的操作系统

| 操作系统 | 支持状态 | 说明 |
|---------|---------|------|
| **Linux** | ✅ 完全支持 | 主要开发平台 |
| **macOS** | ✅ 完全支持 | 完全支持 |
| **Windows** | ✅ 完全支持 | 支持 Windows Terminal 和 CMD |

### 支持的终端

| 终端 | 支持状态 | 说明 |
|------|---------|------|
| **GNOME Terminal** | ✅ 完全支持 | Linux 默认终端 |
| **iTerm2** | ✅ 完全支持 | macOS 流行终端 |
| **Windows Terminal** | ✅ 完全支持 | Windows 现代终端 |
| **CMD** | ⚠️ 部分支持 | 功能受限 |
| **PowerShell** | ✅ 完全支持 | Windows PowerShell |

### 终端能力要求

- **ANSI 转义序列**: 支持
- **256 色或真彩色**: 推荐
- **备用屏幕缓冲区**: 可选（用于高性能模式）
- **鼠标事件**: 可选
- **剪贴板操作**: 可选（OSC52 协议）

## 性能要求

### 最低要求

| 资源 | 最低要求 |
|------|---------|
| **CPU** | 单核处理器 |
| **内存** | 10 MB |
| **磁盘** | 50 MB |

### 推荐配置

| 资源 | 推荐配置 |
|------|---------|
| **CPU** | 双核或更高 |
| **内存** | 50 MB 或更多 |
| **磁盘** | 100 MB 或更多 |

## 安全性考虑

### 依赖安全

- 定期更新依赖包
- 使用 `go mod verify` 验证依赖完整性
- 关注安全公告

### 输入安全

- 文本输入组件支持验证函数
- 文件选择器限制访问范围
- 防止缓冲区溢出

### 终端安全

- 正确处理特殊字符
- 防止终端转义序列注入
- 安全的剪贴板操作

## 兼容性

### Go 版本兼容性

| Go 版本 | 兼容性 |
|---------|--------|
| **1.24.2** | ✅ 完全支持（推荐） |
| **1.23.x** | ✅ 支持 |
| **1.22.x** | ⚠️ 可能需要调整 |
| **< 1.22** | ❌ 不支持 |

### 向后兼容性

- 遵循语义化版本控制
- 重大变更会在版本号中体现
- 废弃功能会提前通知

## 未来技术演进

### 计划中的技术升级

1. **Go 版本升级**: 跟随 Go 语言最新稳定版本
2. **依赖更新**: 定期更新依赖包到最新稳定版本
3. **性能优化**: 持续优化渲染性能
4. **新特性**: 根据社区反馈添加新功能

### 技术债务

- 部分组件可能需要重构以提高性能
- 某些依赖包可能需要替换或更新
- 文档需要持续完善

## 总结

Bubbles-CN 技术栈以 Go 语言为核心，基于 Bubble Tea 的 MVU 架构，结合 Lipgloss 的样式引擎，提供了一套完整的终端 UI 组件解决方案。项目具有良好的跨平台支持、丰富的功能特性和优秀的性能表现。

### 技术栈优势

1. **现代化**: 使用最新的 Go 语言特性和库
2. **模块化**: 清晰的依赖关系和模块划分
3. **可维护**: 良好的代码组织和文档
4. **高性能**: 针对终端环境优化
5. **跨平台**: 支持主流操作系统和终端
6. **可扩展**: 易于扩展和定制

### 技术选型原则

- **稳定性**: 选择成熟、稳定的依赖包
- **性能**: 优先考虑性能优化
- **兼容性**: 确保跨平台兼容
- **可维护性**: 选择有良好文档和社区支持的库
- **安全性**: 关注依赖包的安全性
